# SPF, DKIM, DMARC
## ğŸ“¦ OVERVIEW

|Record|Purpose|Protects Against|Where Defined|
|---|---|---|---|
|**SPF**|Authorizes IPs to send email for a domain|Forged sender IPs|`TXT` record in DNS|
|**DKIM**|Signs emails to verify integrity|Tampering / fake emails|`TXT` + mail server config|
|**DMARC**|Policy for what to do if SPF/DKIM fails|Full domain spoofing|`TXT` record + email reporting|

These are all **DNS-based security records** that protect your domain's email reputation and delivery.

---

## ğŸ”¸ SPF (Sender Policy Framework)

### âœ… What is SPF?

SPF defines **which IP addresses or servers are allowed to send mail for your domain**.

ğŸ“ It helps **recipient MTAs** (like Gmail, Yahoo) check:

> â€œIs this email really allowed to come from this server for `yourdomain.com`?â€

---

### ğŸ” How does it work?

1. Mail server (e.g. Gmail) receives an email claiming to be from `email@yourdomain.com`
    
2. It checks the DNS `TXT` record for yourdomain.com:
    
    ```txt
    v=spf1 include:_spf.google.com ~all
    ```
    
3. It gets a list of IPs/domains allowed to send mail for your domain
    
4. It compares the **sender serverâ€™s IP** with the list
    
5. If match = âœ… SPF Pass  
    If not = âŒ SPF Fail
    

---

### ğŸ§¾ SPF Example Record

```txt
v=spf1 ip4:203.0.113.5 include:_spf.google.com -all
```

Breakdown:

- `v=spf1` â†’ SPF version
    
- `ip4:203.0.113.5` â†’ Allow this IP to send
    
- `include:_spf.google.com` â†’ Allow Gmail to send
    
- `-all` â†’ All others = fail
    

---

### ğŸ›  Who sets SPF?

- **You**, in your DNS zone
    
- Every domain should have it if it sends email
    

---

## ğŸ”¸ DKIM (DomainKeys Identified Mail)

### âœ… What is DKIM?

DKIM lets your **mail server sign outgoing emails with a private key**, and publish the **public key in DNS**.

ğŸ“ This allows receivers to **verify that the email hasnâ€™t been tampered with** and that it came from an authorized sender.

---

### ğŸ” How does DKIM work?

1. Your mail server adds a **DKIM-Signature** header when sending mail
    
2. That header contains:
    
    - `d=yourdomain.com` â†’ Domain
        
    - `s=selector` â†’ DNS selector name
        
    - `bh=hash` â†’ Body hash
        
    - `b=signature` â†’ Encrypted data using your private key
        
3. Receiver checks your DNS for:
    
    ```
    TXT record: selector._domainkey.yourdomain.com
    ```
    
4. It gets your public key from DNS
    
5. Verifies that the signature matches and body wasnâ€™t modified
    

---

### ğŸ§¾ DKIM DNS Example

```txt
Name:  default._domainkey.yourdomain.com
Type:  TXT  
Value:  v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3... (public key here)
```

---

### ğŸ›  Who sets DKIM?

- Your mail provider (Zoho, Google Workspace, etc.)
    
- Or you (if self-hosting with Postfix + OpenDKIM)
    

---

## ğŸ”¸ DMARC (Domain-based Message Authentication, Reporting, and Conformance)

### âœ… What is DMARC?

DMARC tells receivers **how to handle emails that fail SPF and/or DKIM**.

ğŸ“ It builds on SPF/DKIM and defines a **policy** + lets you get **reports** about abuse.

---

### ğŸ” How does DMARC work?

1. An email arrives claiming to be from yourdomain.com
    
2. The receiver checks:
    
    - Did SPF pass? Was the domain aligned?
        
    - Did DKIM pass? Was it signed by your domain?
        
3. Based on your DMARC policy, it:
    
    - Accepts (none)
        
    - Quarantines (goes to spam)
        
    - Rejects (blocked)
        

---

### ğŸ§¾ DMARC DNS Example

```txt
Name: _dmarc.yourdomain.com  
Type: TXT  
Value: v=DMARC1; p=quarantine; rua=mailto:dmarc@yourdomain.com
```

Breakdown:

- `v=DMARC1` â†’ version
    
- `p=quarantine` â†’ Policy if fail: send to spam
    
- `rua=mailto:...` â†’ Aggregate reports emailed here
    
- `pct=100` â†’ Apply policy to 100% of messages (optional)
    

---

### ğŸ›  Who sets DMARC?

- You, in your domainâ€™s DNS
    
- DMARC **requires that SPF or DKIM passes with alignment**
    

---

## ğŸ” What is â€œalignmentâ€?

For **DMARC to pass**, SPF or DKIM must pass **and** the domain used in that record must match the `From:` domain.

|Mechanism|Domain checked|
|---|---|
|SPF|Return-Path vs From|
|DKIM|d= (in signature) vs From|

So:

- âœ… If `From: email@yourdomain.com`
    
- âœ… SPF passes and Return-Path is also `@yourdomain.com` â†’ aligned = DMARC pass
    
- âŒ If SPF passes but sent via Gmail (Return-Path is `@gmail.com`) â†’ **not aligned** = DMARC fail
    

---

## ğŸ” Why do all these matter?

To **protect your domain from abuse**, **ensure delivery**, and **maintain reputation**:

|Problem|Solved by|
|---|---|
|Anyone spoofing your domain|âœ… SPF, DKIM, DMARC|
|Messages altered in transit|âœ… DKIM|
|Prevent spam from using your domain|âœ… DMARC|
|Better inbox delivery|âœ… All of them|

---

## âœ… Practical Summary (Real World)

|Record|You add to DNS?|Needed to send email?|Needed to avoid spam?|
|---|---|---|---|
|SPF|âœ… Yes|âœ… Strongly recommended|âœ… Yes|
|DKIM|âœ… Yes|âœ… Yes (for DMARC)|âœ… Yes|
|DMARC|âœ… Yes|âŒ Not required to send|âœ… Yes (for reputation)|

---

## ğŸ§ª Check your domainâ€™s records

Use tools like:

- ğŸ” [https://mxtoolbox.com](https://mxtoolbox.com/)
    
- ğŸ” [https://dmarcian.com/dmarc-inspector/](https://dmarcian.com/dmarc-inspector/)
    
- ğŸ” [https://www.mail-tester.com](https://www.mail-tester.com/)
    

---
