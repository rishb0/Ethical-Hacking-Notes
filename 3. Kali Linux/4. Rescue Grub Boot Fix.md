# GRUB Rescue Recovery and fstab Fix After Partition Move (Kali Linux)

## Problem Statement

After resizing or moving the Linux partition using tools like GParted Live, the system failed to boot and dropped into GRUB rescue mode:

```
grub rescue>
```

## Root Cause

- GRUB was configured to boot from a specific partition number and UUID
- Moving or resizing partitions can change the partition number or UUID
- GRUB could no longer locate its `/boot/grub` directory and entered rescue mode

## Recovery Process

### Step 1: Identify Boot Partition from GRUB Rescue

#### List all available partitions:
```grub
ls
```

Output example:
```
(hd0) (hd0,msdos1) (hd0,msdos2) ...
```

#### Check each partition for `/boot/grub` directory:
```grub
ls (hd0,msdos1)/
```

```grub
ls (hd0,msdos2)/
```

Continue checking until you find the partition containing `/boot` and `/boot/grub`.

#### Set the correct partition as root:
```grub
set root=(hd0,msdosX)
```

#### Set the GRUB prefix:
```grub
set prefix=(hd0,msdosX)/boot/grub
```

#### Load normal module:
```grub
insmod normal
```

#### Boot into normal mode:
```grub
normal
```

This will boot the system temporarily.

### Step 2: Permanently Fix GRUB After Boot

#### If booted from Live USB, mount the system:

Mount root partition:
```bash
sudo mount /dev/sdaX /mnt
```

Bind mount system directories:
```bash
sudo mount --bind /dev /mnt/dev
```

```bash
sudo mount --bind /proc /mnt/proc
```

```bash
sudo mount --bind /sys /mnt/sys
```

Change root to mounted system:
```bash
sudo chroot /mnt
```

#### Reinstall GRUB:

Install GRUB to MBR:
```bash
grub-install /dev/sda
```
Note: identify the boot partition in your pc and then do this thing on the boot partition , means the partition in which boot loader is installed  i.e. `/boot/`

Update GRUB configuration:
```bash
update-grub
```

Exit chroot (if applicable):
```bash
exit
```

Reboot system:
```bash
sudo reboot
```

### Step 3: Fix `/etc/fstab` with Correct UUIDs

#### Check current partition UUIDs:
```bash
blkid
```

#### Edit fstab configuration:
```bash
sudo nano /etc/fstab
```

Update UUIDs to match the output from `blkid`.

Example fstab entry:
```
UUID=1234-5678-90AB-CDEF   /   ext4   errors=remount-ro   0   1
```

#### Verify mount configuration:
```bash
sudo mount -a
```

If no errors appear, fstab is correctly configured.

## Verification

After completing these steps:
- System should boot normally without entering GRUB rescue
- GRUB files should be accessible under `/boot/grub/`
- UUIDs in `/etc/fstab` must match actual disk UUIDs from `blkid`

## Additional Notes

- Replace `X` in `/dev/sdaX` and `(hd0,msdosX)` with your actual partition number
- For GPT disks, partition notation might be `(hd0,gpt1)` instead of `(hd0,msdos1)`
- Always backup important data before modifying partitions

---
---
